{% extends 'base.html' %}
{% block content %}
<div class="page-header">
	<div class="d-flex justify-content-between align-items-center">
		<div>
			<h3>
				<i class="bi bi-speedometer2 me-2 text-primary"></i>HR / Supervisor Dashboard
			</h3>
			<p class="text-muted mb-0">Monitor and manage all intern activities</p>
		</div>
		<div>
			<a href="{% url 'hr_export_csv' %}?{{ request.GET.urlencode }}" class="btn btn-success">
				<i class="bi bi-download me-2"></i>Export CSV
			</a>
		</div>
	</div>
</div>

<div class="card mb-4">
	<div class="card-header">
		<i class="bi bi-funnel me-2"></i>Filter Options
	</div>
	<div class="card-body">
		<form method="get" class="row g-3">
			<div class="col-md-2">
				<label class="form-label fw-semibold">
					<i class="bi bi-calendar-event me-1"></i>{{ form.start_date.label }}
				</label>
				{{ form.start_date }}
			</div>
			<div class="col-md-2">
				<label class="form-label fw-semibold">
					<i class="bi bi-calendar-event me-1"></i>{{ form.end_date.label }}
				</label>
				{{ form.end_date }}
			</div>
			<div class="col-md-2">
				<label class="form-label fw-semibold">
					<i class="bi bi-flag me-1"></i>{{ form.status.label }}
				</label>
				{{ form.status }}
			</div>
			<div class="col-md-2">
				<label class="form-label fw-semibold">
					<i class="bi bi-person-badge me-1"></i>{{ form.staff_id.label }}
				</label>
				{{ form.staff_id }}
			</div>
			<div class="col-md-3">
				<label class="form-label fw-semibold">
					<i class="bi bi-person me-1"></i>{{ form.intern_name.label }}
				</label>
				{{ form.intern_name }}
			</div>
			<div class="col-md-1 d-flex align-items-end">
				<button class="btn btn-primary w-100" type="submit">
					<i class="bi bi-search"></i>
				</button>
			</div>
		</form>
	</div>
</div>

<div class="card">
	<div class="card-header">
		<i class="bi bi-list-ul me-2"></i>All Intern Activities
		<span class="badge bg-light text-dark ms-2">{{ tasks.count }} records</span>
	</div>
	<div class="card-body p-0">
		<div class="table-responsive">
			<table class="table table-hover mb-0">
				<thead>
					<tr>
						<th><i class="bi bi-calendar3 me-1"></i>Date</th>
						<th><i class="bi bi-person me-1"></i>Intern</th>
						<th><i class="bi bi-building me-1"></i>Department</th>
						<th><i class="bi bi-person-badge me-1"></i>Staff</th>
						<th><i class="bi bi-id-card me-1"></i>Staff ID</th>
						<th><i class="bi bi-telephone me-1"></i>Phone</th>
						<th><i class="bi bi-flag me-1"></i>Status</th>
						<th><i class="bi bi-list-task me-1"></i>Task</th>
						<th><i class="bi bi-chat-left-text me-1"></i>Remarks</th>
					</tr>
				</thead>
				<tbody>
					{% for t in tasks %}
					<tr>
						<td><strong>{{ t.date }}</strong></td>
						<td>
							<strong>{{ t.intern.name }}</strong>
							<br><small class="text-muted">{{ t.intern.email }}</small>
						</td>
						<td>
							<span class="badge bg-info">{{ t.intern.department }}</span>
						</td>
						<td>{% if t.staff_name %}{{ t.staff_name }}{% elif t.staff %}{{ t.staff.name }}{% else %}-{% endif %}</td>
						<td>{{ t.staff_identifier|default:"-" }}</td>
						<td>{{ t.staff_phone|default:"-" }}</td>
						<td>
							<span class="badge {% if t.status == 'Resolved' %}bg-success{% else %}bg-warning text-dark{% endif %}">
								<i class="bi bi-{% if t.status == 'Resolved' %}check-circle{% else %}clock{% endif %} me-1"></i>{{ t.status }}
							</span>
						</td>
						<td style="white-space: pre-wrap; max-width: 250px;">{{ t.task_description|truncatewords:20 }}</td>
						<td style="white-space: pre-wrap; max-width: 200px;">{{ t.remarks|default:"-"|truncatewords:15 }}</td>
					</tr>
					{% empty %}
					<tr>
						<td colspan="9" class="empty-state">
							<i class="bi bi-inbox"></i>
							<p class="mb-0">No records found. Try adjusting your filters.</p>
						</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
</div>
{% endblock %}


