{% extends 'base.html' %}
{% block content %}
<div class="page-header">
	<div class="d-flex justify-content-between align-items-center">
		<div>
			<h3>
				<i class="bi bi-person-circle me-2 text-primary"></i>
				Welcome, {{ request.user.get_full_name|default:request.user.username }}
			</h3>
			<p class="text-muted mb-0">Manage your daily tasks and track your progress</p>
		</div>
		<div class="d-flex gap-2">
			<a href="{% url 'intern_analytics' %}" class="btn btn-success">
				<i class="bi bi-graph-up-arrow me-1"></i>View Analytics
			</a>
			{% if request.user.is_staff %}
				<a href="{% url 'hr_dashboard' %}" class="btn btn-outline-primary">
					<i class="bi bi-speedometer2 me-1"></i>HR Dashboard
				</a>
			{% endif %}
		</div>
	</div>
</div>

<div class="row g-4">
	<div class="col-lg-5">
		<div class="card">
			<div class="card-header">
				<i class="bi bi-journal-plus me-2"></i>Daily Logbook Entry
			</div>
			<div class="card-body">
				<form method="post" action="{% url 'task_create' %}">
					{% csrf_token %}
					<div class="mb-3">
						<label class="form-label fw-semibold">
							<i class="bi bi-calendar3 me-1"></i>{{ form.date.label }}
						</label>
						{{ form.date }}
					</div>
					<div class="mb-3">
						<label class="form-label fw-semibold">
							<i class="bi bi-list-task me-1"></i>{{ form.task_description.label }}
						</label>
						{{ form.task_description }}
					</div>
					<div class="row">
						<div class="col-md-6 mb-3">
							<label class="form-label fw-semibold">
								<i class="bi bi-person me-1"></i>{{ form.staff_name.label }}
							</label>
							{{ form.staff_name }}
						</div>
						<div class="col-md-6 mb-3">
							<label class="form-label fw-semibold">
								<i class="bi bi-id-card me-1"></i>{{ form.staff_identifier.label }}
							</label>
							{{ form.staff_identifier }}
						</div>
					</div>
					<div class="mb-3">
						<label class="form-label fw-semibold">
							<i class="bi bi-telephone me-1"></i>{{ form.staff_phone.label }}
						</label>
						{{ form.staff_phone }}
					</div>
					<div class="mb-3">
						<label class="form-label fw-semibold">
							<i class="bi bi-flag me-1"></i>{{ form.status.label }}
						</label>
						{{ form.status }}
					</div>
					<div class="d-grid">
						<button type="submit" class="btn btn-primary">
							<i class="bi bi-check-circle me-2"></i>Submit Task
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	<div class="col-lg-7">
		<div class="card">
			<div class="card-header">
				<i class="bi bi-clock-history me-2"></i>Task History
			</div>
			<div class="card-body p-0">
				<div class="table-responsive">
					<table class="table table-hover mb-0">
						<thead>
							<tr>
								<th><i class="bi bi-calendar3 me-1"></i>Date</th>
								<th><i class="bi bi-list-task me-1"></i>Task</th>
								<th><i class="bi bi-clock me-1"></i>Submitted</th>
								<th><i class="bi bi-person me-1"></i>Staff</th>
								<th><i class="bi bi-id-card me-1"></i>ID</th>
								<th><i class="bi bi-telephone me-1"></i>Phone</th>
								<th><i class="bi bi-flag me-1"></i>Status</th>
								<th></th>
							</tr>
						</thead>
						<tbody>
							{% for t in tasks %}
							<tr>
								<td><strong>{{ t.date }}</strong></td>
								<td style="white-space: pre-wrap; max-width: 300px;">{{ t.task_description|truncatewords:15 }}</td>
								<td>{{ t.created_at|date:"Y-m-d H:i" }}</td>
								<td>{% if t.staff_name %}{{ t.staff_name }}{% elif t.staff %}{{ t.staff.name }}{% else %}-{% endif %}</td>
								<td>{{ t.staff_identifier|default:"-" }}</td>
								<td>{{ t.staff_phone|default:"-" }}</td>
								<td>
									<span class="badge {% if t.status == 'Resolved' %}bg-success{% else %}bg-warning text-dark{% endif %}">
										<i class="bi bi-{% if t.status == 'Resolved' %}check-circle{% else %}clock{% endif %} me-1"></i>{{ t.status }}
									</span>
								</td>
								<td class="text-end">
									<a href="{% url 'task_update_status' t.id %}" class="btn btn-sm btn-outline-primary">
										<i class="bi bi-arrow-repeat me-1"></i>Toggle
									</a>
								</td>
							</tr>
							{% empty %}
							<tr>
								<td colspan="7" class="empty-state">
									<i class="bi bi-inbox"></i>
									<p class="mb-0">No tasks recorded yet. Start by submitting your first task!</p>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}


